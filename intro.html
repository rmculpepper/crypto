<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1&nbsp;Introduction to the Crypto Library</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Crypto:<span class="mywbr"> &nbsp;</span> Cryptographic Operations</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Introduction to the Crypto Library</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="factory.html" class="tocviewlink" data-pltdoc="x">Cryptography Factories</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="digest.html" class="tocviewlink" data-pltdoc="x">Message Digests</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="cipher.html" class="tocviewlink" data-pltdoc="x">Symmetric Encryption</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="pk.html" class="tocviewlink" data-pltdoc="x">Public-<wbr></wbr>Key Cryptography</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="kdf.html" class="tocviewlink" data-pltdoc="x">Key Derivation and Password Hashing</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="misc.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Notes and Utilities</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Introduction to the Crypto Library</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._intro-crypto%29" class="tocviewlink" data-pltdoc="x">Cryptography Examples</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._intro-pk%29" class="tocviewlink" data-pltdoc="x">Public-<wbr></wbr>Key Cryptography Examples</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._intro-crypto%29" class="tocsubseclink" data-pltdoc="x">Cryptography Examples</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._intro-pk%29" class="tocsubseclink" data-pltdoc="x">Public-<wbr></wbr>Key Cryptography Examples</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="factory.html" title="forward to &quot;2 Cryptography Factories&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>1<tt>&nbsp;</tt><a name="(part._intro)"></a>Introduction to the Crypto Library</h3><p>Cryptography is not security. It is a tool that may be used in some
cases to achieve security goals.</p><p>This library is not a turn-key solution to security. It is a library
of low-level cryptographic operations&#8212;<wbr></wbr>or, in other words, just
enough rope for the unwary to hang themselves.</p><p>This manual assumes that you already know to use the cryptographic
operations properly. Every operation has conditions that must be
satisfied for the operation&rsquo;s security properties to hold; they are
not always well-advertised in documentation or literature, and they
are sometimes revised as new weaknesses or attacks are
discovered. Aside from the occasional off-hand comment, this manual
does not discuss them at all. You are on your own.</p><h4>1.1<tt>&nbsp;</tt><a name="(part._intro-crypto)"></a>Cryptography Examples</h4><p>In order to use a cryptographic operation, you need an implementation
of it from a crypto provider. Implementations are managed through
crypto factories. This introduction will use the factory for libcrypto
(OpenSSL), since it is widely available and supports many useful
cryptographic operations. See <a href="factory.html" data-pltdoc="x">Cryptography Factories</a> for other crypto
providers.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">crypto</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">crypto/libcrypto</span><span class="RktPn">)</span></td></tr></table></blockquote><p>You can configure this library with a &ldquo;search path&rdquo; of crypto
factories:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="factory.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._crypto-factories%29%29" class="RktValLink" data-pltdoc="x">crypto-factories</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="factory.html#%28def._%28%28lib._crypto%2Flibcrypto..rkt%29._libcrypto-factory%29%29" class="RktValLink" data-pltdoc="x">libcrypto-factory</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>That allows you to perform an operation by providing a crypto
algorithm specifier, which is automatically resolved to an
implementation using the factories in <span class="RktPn">(</span><span class="RktSym"><a href="factory.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._crypto-factories%29%29" class="RktValLink" data-pltdoc="x">crypto-factories</a></span><span class="RktPn">)</span>. For
example, to compute a message digest, call the <span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span>
function with the name of the digest algorithm:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\323Hj\351\23nxV\274B!#\205\352yp\224GX\2"</span></p></td></tr></table></blockquote><p>Or, if you prefer, you can obtain an algorithm implementation
explicitly:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-impl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._get-digest%29%29" class="RktValLink" data-pltdoc="x">get-digest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="factory.html#%28def._%28%28lib._crypto%2Flibcrypto..rkt%29._libcrypto-factory%29%29" class="RktValLink" data-pltdoc="x">libcrypto-factory</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-impl</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\323Hj\351\23nxV\274B!#\205\352yp\224GX\2"</span></p></td></tr></table></blockquote><p>To encrypt using a symmetric cipher, call the <span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span>
function with a cipher specifier consisting of the name of the cipher
and the cipher mode (see <span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._cipher-spec~3f%29%29" class="RktValLink" data-pltdoc="x">cipher-spec?</a></span> for details).</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">skey</span><span class="hspace">&nbsp;</span><span class="RktVal">#"VeryVerySecr3t!!"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._make-bytes%29%29" class="RktValLink" data-pltdoc="x">make-bytes</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._cipher-iv-size%29%29" class="RktValLink" data-pltdoc="x">cipher-iv-size</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">ctr</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">ctr</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">skey</span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"wu\345\215\e\16\256\355.\242\30x"</span></p></td></tr></table></blockquote><p>Of course, using an all-zero IV is usually a very bad idea. You can
generate a random IV of the right size (if a random IV is
appropriate), or you can get the IV size and construct one yourself:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-cipher-iv%29%29" class="RktValLink" data-pltdoc="x">generate-cipher-iv</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">ctr</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">iv</span></td></tr><tr><td><p><span class="RktRes">#"\351\256\17\\f\3505l\227\235\17\0007\376\vu"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._cipher-iv-size%29%29" class="RktValLink" data-pltdoc="x">cipher-iv-size</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">ctr</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">16</span></p></td></tr></table></blockquote><p>There are also functions to generate session keys, HMAC keys,
etc. These functions use <span class="RktSym"><a href="misc.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._crypto-random-bytes%29%29" class="RktValLink" data-pltdoc="x">crypto-random-bytes</a></span>, a
cryptographically strong source of randomness.</p><p>When an <a href="cipher.html#%28tech._authenticated._encryption%29" class="techoutside" data-pltdoc="x"><span class="techinside">authenticated encryption</span></a> (AEAD) cipher, such as
AES-GCM, is used with <span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span> or <span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._decrypt%29%29" class="RktValLink" data-pltdoc="x">decrypt</a></span>, the
authentication tag is automatically appended to (or taken from) the
end of the cipher text, respectively. AEAD ciphers also support
<span style="font-style: italic">additionally authenticated data</span>, passed with the <span class="RktPn">#:aad</span>
keyword.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-cipher-key%29%29" class="RktValLink" data-pltdoc="x">generate-cipher-key</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">gcm</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-cipher-iv%29%29" class="RktValLink" data-pltdoc="x">generate-cipher-iv</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">gcm</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ct</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">gcm</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktVal">#"Nevermore!"</span><span class="hspace">&nbsp;</span><span class="RktPn">#:aad</span><span class="hspace">&nbsp;</span><span class="RktVal">#"quoth the raven"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._decrypt%29%29" class="RktValLink" data-pltdoc="x">decrypt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">gcm</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktSym">ct</span><span class="hspace">&nbsp;</span><span class="RktPn">#:aad</span><span class="hspace">&nbsp;</span><span class="RktVal">#"quoth the raven"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"Nevermore!"</span></p></td></tr></table></blockquote><p>If authentication fails at the end of decryption, an exception is
raised:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._decrypt%29%29" class="RktValLink" data-pltdoc="x">decrypt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">aes</span><span class="hspace">&nbsp;</span><span class="RktVal">gcm</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">key</span><span class="hspace">&nbsp;</span><span class="RktSym">iv</span><span class="hspace">&nbsp;</span><span class="RktSym">ct</span><span class="hspace">&nbsp;</span><span class="RktPn">#:aad</span><span class="hspace">&nbsp;</span><span class="RktVal">#"said the bird"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">decrypt: authenticated decryption failed</span></p></td></tr></table></blockquote><p>In addition to &ldquo;all-at-once&rdquo; operations like <span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span> and
<span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span>, this library also supports algorithm contexts for
incremental computation.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-ctx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._make-digest-ctx%29%29" class="RktValLink" data-pltdoc="x">make-digest-ctx</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest-update%29%29" class="RktValLink" data-pltdoc="x">digest-update</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-ctx</span><span class="hspace">&nbsp;</span><span class="RktVal">#"Hello "</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest-update%29%29" class="RktValLink" data-pltdoc="x">digest-update</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-ctx</span><span class="hspace">&nbsp;</span><span class="RktVal">#"world!"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest-final%29%29" class="RktValLink" data-pltdoc="x">digest-final</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sha1-ctx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\323Hj\351\23nxV\274B!#\205\352yp\224GX\2"</span></p></td></tr></table></blockquote><h4>1.2<tt>&nbsp;</tt><a name="(part._intro-pk)"></a>Public-Key Cryptography Examples</h4><p>Public-key (PK) cryptography uses keypairs consisting of public and
private keys. A keypair can be generated by calling
<span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-private-key%29%29" class="RktValLink" data-pltdoc="x">generate-private-key</a></span> with the desired PK cryptosystem and an
association list of key-generation options. The private key consists
of the whole keypair&#8212;<wbr></wbr>both private and public components. A key
containing only the public components can be obtained with the
<span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-key-~3epublic-only-key%29%29" class="RktValLink" data-pltdoc="x">pk-key-&gt;public-only-key</a></span> function.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rsa-impl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._get-pk%29%29" class="RktValLink" data-pltdoc="x">get-pk</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">rsa</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="factory.html#%28def._%28%28lib._crypto%2Flibcrypto..rkt%29._libcrypto-factory%29%29" class="RktValLink" data-pltdoc="x">libcrypto-factory</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">privkey</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-private-key%29%29" class="RktValLink" data-pltdoc="x">generate-private-key</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rsa-impl</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">nbits</span><span class="hspace">&nbsp;</span><span class="RktVal">512</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-key-~3epublic-only-key%29%29" class="RktValLink" data-pltdoc="x">pk-key-&gt;public-only-key</a></span><span class="hspace">&nbsp;</span><span class="RktSym">privkey</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>RSA keys support both signing and encryption. Other PK cryptosystems
may support different operations; for example, DSA supports signing
but not encryption, and DH only supports key agreement.</p><p>PK signature algorithms are limited in the amount of data they can
sign directly, so the message is first processed with a digest
function, then the digest is signed. The <span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%2Fsign%29%29" class="RktValLink" data-pltdoc="x">digest/sign</a></span> and
<span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%2Fverify%29%29" class="RktValLink" data-pltdoc="x">digest/verify</a></span> functions compute the digest automatically. The
private key signs, and the public key verifies.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%2Fsign%29%29" class="RktValLink" data-pltdoc="x">digest/sign</a></span><span class="hspace">&nbsp;</span><span class="RktSym">privkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%2Fverify%29%29" class="RktValLink" data-pltdoc="x">digest/verify</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%2Fverify%29%29" class="RktValLink" data-pltdoc="x">digest/verify</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Transfer $100"</span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote><p>It is also possible to sign a precomputed digest. The digest algorithm
is still required as an argument, because some signature schemes include a
digest algorithm identifier.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dgst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-sign-digest%29%29" class="RktValLink" data-pltdoc="x">pk-sign-digest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">privkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktSym">dgst</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-verify-digest%29%29" class="RktValLink" data-pltdoc="x">pk-verify-digest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-verify-digest%29%29" class="RktValLink" data-pltdoc="x">pk-verify-digest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sha1</span><span class="hspace">&nbsp;</span><span class="RktVal">"Transfer $100"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sig</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote><p>Encryption is similar, except that the public key encrypts, and the
private key decrypts.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">skey</span><span class="hspace">&nbsp;</span><span class="RktVal">#"VeryVerySecr3t!!"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e-skey</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-encrypt%29%29" class="RktValLink" data-pltdoc="x">pk-encrypt</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pubkey</span><span class="hspace">&nbsp;</span><span class="RktSym">skey</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._pk-decrypt%29%29" class="RktValLink" data-pltdoc="x">pk-decrypt</a></span><span class="hspace">&nbsp;</span><span class="RktSym">privkey</span><span class="hspace">&nbsp;</span><span class="RktSym">e-skey</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"VeryVerySecr3t!!"</span></p></td></tr></table></blockquote><p>The other PK operation is key agreement, or shared secret
derivation. Two parties exchange public keys, and each party uses
their own private key together with their peer&rsquo;s public key to derive
a shared secret.</p><p>For additional examples, see the <span class="stt">crypto/examples</span> directory
(<a href="https://github.com/rmculpepper/crypto/tree/master/crypto-doc/examples">online here</a>).</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="factory.html" title="forward to &quot;2 Cryptography Factories&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>